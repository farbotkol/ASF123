<apex:page showHeader="true" sidebar="false" standardController="Risk__c" extensions="ECO_RiskRegisterController" id="thePage">

    <apex:includeScript value="{!$Resource.ECO_jQuery_1_11_2_min_js}"/>

    <script type="text/javascript" >
        var budgetHidden = true;
        var titleHidden = true;
        var budgetTitleHidden = true;

        $(document).ready(function(){
            $("[id$=mlktp]").hide();

            $('.budget').click(function(){
                budgetHidden = !budgetHidden;

                toggleSections();
            })

            $('.title').click(function(){
                titleHidden = !titleHidden;

                toggleSections();
            })
            $('.showAll').click(function(){
                titleHidden = !titleHidden;
                budgetHidden = !budgetHidden;

                toggleSections();
            })

            $('.budget input, .title input, .showAll input').click(function(){
                event.stopPropagation();
            })

        });

        function toggleSections(){
            if(!budgetHidden){
                $('.budgetDetail').slideDown(250, function(){
                    $('.expandable').text("-");
                });
            }else{
                $('.budgetDetail').slideUp(250, function(){
                    $('.expandable').text("+");
                });
            }
            
            if(!titleHidden){
                $('.titleDetail').slideDown(250, function(){
                    $('.expandable').text("-");
                });
            }else{
                $('.titleDetail').slideUp(250, function(){
                    $(".expandable").text("+");
                });
            }

            if(!budgetHidden && !titleHidden){
                $('.titleHeader').slideDown(250, function(){
                    $('.expandable').text("-");
                });
            }else{
                $('.titleHeader').slideUp(250, function(){
                    $('.expandable').text("+");
                });
            }

        }
    </script>

    <style>
        /* tables */
        table.tablesorter {
            font-family:arial;
            background-color: #919191;
            margin:10px 0pt 15px;
            font-size: 9pt; 
            width: 100%;
            text-align: left;
        }
        table.tablesorter thead tr th, table.tablesorter tfoot tr th, table.tablesorter tr th {
            background-color: #39c;
            border: 1px solid #FFF;
            font-size: 9pt;
            padding: 4px 7px;
            color:white;
        }

        table.tablesorter thead tr .header {
            background-image: url(bg.gif);
            background-repeat: no-repeat;
            background-position: center right;
            cursor: pointer;
        }
        table.tablesorter tbody td {
            color: #3D3D3D;
            padding: 4px 7px;
            background-color: #FFF;
            vertical-align: top;
            height: 20px;
        }

        table.tablesorter tbody tr:hover td{
            background-color:#FFFFEB !important;
        }

        table.tablesorter tbody tr.odd td {
            background-color:#F0F0F6;
        }
        table.tablesorter thead tr .headerSortUp {
            background-image: url(asc.gif);
        }
        table.tablesorter thead tr .headerSortDown {
            background-image: url(desc.gif);
        }
        table.tablesorter thead tr .headerSortDown, table.tablesorter thead tr .headerSortUp {
        background-color: #8dbdd8;
        }

        table.tablesorter thead tr th.greenColumn, table.tablesorter thead tr th.greenColumn{
            background-color:#AFBCA0;
        }

        table.tablesorter tbody tr td.budget input, table.tablesorter tbody tr td.budget{
            text-align:right;
        }

        table.tablesorter tbody tr:nth-child(odd) td.greenColumn, table.tablesorter tbody tr:nth-child(odd) td.greenColumn, table.tablesorter tbody tr:nth-child(odd) td.greenColumn, table.tablesorter tbody tr:nth-child(odd) td.greenColumn{
            background-color:#EDF1E8;
        }

        table.tablesorter tbody tr:nth-child(even) td.greenColumn, table.tablesorter tbody tr:nth-child(even) td.greenColumn, table.tablesorter tbody tr:nth-child(even) td.greenColumn, table.tablesorter tbody tr:nth-child(even) td.greenColumn{
            background-color:#F9FAF8;
        }

        table.tablesorter tbody tr:nth-child(odd) td{
            background-color:#EBF5FA;
            white-space: nowrap;
        }

        table.tablesorter tbody tr:nth-child(even) td{
            background-color:white;
            white-space: nowrap;
        }

        table.tablesorter tbody tr input, table.tablesorter tbody tr select{
            width:140px;
        }

        .percSign{
            position:relative;
            top:1px;
            padding-left:2px;
        }

        .budgetDetail{
            display:none;
        }

        .titleDetail{
            display:none;
        }

        .budgetTotal{
            cursor:pointer;
        }

        .title{
            cursor:pointer;
        }
        .hideThis{
            display:none !important;
        }



        /* EXPANDABLE INDICATORS and RISK TABLE - ANDREW SMITH */
        .expandable{
            float:right;
            display:block;
            text-align:center;
            vertical-align:middle;
            padding:1px 5px;
            border:1px solid #128506;
            background-color:#56BD4C;
            color:#fff;
            font-weight:bold;
            border-radius: 10px;
            margin-left:10px;
            margin-top:-2px;
        }
        .title:hover > .expandable, .budgetTotal:hover > .expandable{
            background-color:#ebebeb;
            border: 1px solid #fff;
            color:#333;
        }
        .title, .budgetTotal{
            vertical-align:middle;
        }
        .individualPalette .pbBody table tr th.greenColumn, .individualPalette .pbBody table tr th.greenColumn{
            background-color:#;
        }
        .colorIndicator{
            background-color:#;
            width:13px;
            height:13px;
            display:inline-block;
            vertical-align:middle;
        }
        .infoSection{
            width:100%;
            padding: 5px 0 5px;
        }
        .infoSection .expandable{
            display:inline-block;
            float:none !important;
            margin-left:0 !important;
            padding:1px 5px !important;
        }
        .infoSection .expandable:hover{
            background-color:#ebebeb;
            border: 1px solid #fff;
            color:#333;
        }
        .showAll{
            padding:4px 3px 4px 3px !important;
        }
        .showAll:hover{
            text-decoration:none;
            color:#333 !important;
        }
        .riskLikelihood table{
            border:2px solid #333;
            background-color:#fff;
        }
        .riskLikelihood td, .riskLikelihood th{
            border-right:1px solid #CCCCCC !important;
            padding:11px 5px 0 5px;
            text-align:center;
            width:75px;
            height:43px;
        }
        .riskLikelihood tr td:first-child, .riskLikelihood tr th:first-child{
            border-left:1px solid #ccc !important;
        }
        .riskLikelihood td{
            border-bottom:1px solid #ccc !important;
        }
        .riskLikelihood td:first-child{
            font-weight:bold;
        }
        .riskLikelihood table th{
            border-top:1px solid #ccc !important;
            border-bottom:1px solid #ccc !important;
        }
        .riskLikelihood .greenTd{
            background-color:#6AD360;
            font-size:18px;
            font-weight:bold;
            padding-top:17px;
        }
        .riskLikelihood .yellowTd{
            background-color:#E8E964;
            font-size:18px;
            font-weight:bold;
            padding-top:17px;
        }
        .riskLikelihood .redTd{
            background-color:#F3573D;
            font-size:18px;
            font-weight:bold;
            padding-top:17px;
        }
        .leftLabel{
            float:left;
            width:70px;
            padding-top:135px;
        }
        .topLabel{
            width:412px;
            text-align:center;
            margin-bottom:8px;
        }
        .riskLikelihood{
            margin-top:30px;
        }
        .riskLikelihood h2{
            font-size:18px;
        }
        .riskLikelihood h3{
            font-size:14px;
        }
        
 /* CUSTOM HELP / GUIDANCE TEXT BOX */
        .customHelpText{
            padding: 7px;
            border: 1px solid #85B3CE;
            min-height: 30px;
            display: block;
            width: auto;
            margin: 0 0 5px 0;
            background-repeat: no-repeat;
            border-radius: 4px;
            background-color: #A2D3F1;
            
        }
        .customHelpBody{
            display:inline-block;
            color:#;
            max-width:95%;
        }

    </style>
    
    <apex:sectionHeader title="Risk Register" subtitle="{!theProject.Name}" id="theSectionHeader" />
    
    <apex:pageMessages id="pageMessages" />
    
        <div class="customHelpText">
            <div class="customHelpBody">
            Consider the following approach when managing risk on a project: 
            <ul>
                <li>Determine the nature of the risk that may or has occurred</li>
                <li>Determine appropriate mitigation measures to manage the risk</li>       
                <li>Determine the consequence and likelihood of the risk occurring both pre and post mitigation measures</li>
                <li>Determine if financial contingencies are appropriate to manage the risk in the event that it does occur</li>               
                <li>Ensure all stakeholders are aware of the risks that must be managed throughout the project</li>            
            </ul>        
            </div>   
        </div>
            
    <apex:form id="theForm" >
        
        <apex:actionStatus startText="loading" id="theStatus" />
        
        <apex:pageBlock id="theBlock" title="Project Risk List">

            <div class="infoSection">
                Click  <div class="expandable showAll" style="cursor:pointer;">+</div>  to expand and collapse additional data
            </div>
        
            <apex:pageBlockButtons location="top">
                <a value="Show/Hide All Content" class="btn showAll" style="margin:-2px 0 0 -1px;" >Show/Hide All Content</a>
                <apex:commandButton action="{!addRisk}" value="Add New Risk" rerender="pageMessages, theBlock"/>
                <apex:commandButton action="{!searchKnowledge}" value="Search Knowledge Library" />
                <apex:commandButton action="{!showCopyFromExisting}" value="Copy Risks From Existing Project" rerender="pageMessages, theBlock" status="theStatus" rendered="{!!isCopySectionShown}" />
                <apex:commandButton action="{!save}" value="Save" rerender="pageMessages, theBlock"/>
                <apex:commandButton action="{!backToProject}" value="Back to Project" immediate="true"/>
            </apex:pageBlockButtons>

            
            <apex:pageBlockSection id="existingProjectLookupSection" rendered="{!isCopySectionShown}">
                Project to Copy Risks From: 
                <apex:inputField value="{!projectFieldProvider.Project__c}" />
                <apex:commandButton action="{!copyFromExisting}" value="Copy Risks" rerender="pageMessages, theBlock" status="theStatus" />
            </apex:pageBlockSection>
                    
                <table class="tablesorter" cellspacing="0" cellpadding="0">
                    <thead>
                        <tr>
                            <th class="budgetDetail" style="background-color:transparent !important;" colspan="6">
                            </th>
                            <th class="titleDetail" style="background-color:transparent !important;" colspan="7">
                            </th>
                            <th class="budget budgetDetail " colspan="2">
                                <div style="width:236px;text-align:center;">Raw Contingency</div>
                            </th>
                            <th class="budget budgetDetail " colspan="2">
                                <div style="width:236px;text-align:center;">Weighted Contingency</div>
                            </th>
                        </tr>
 
                        <tr>
                            <th class="title">
                                #
                            </th>
                            <th class="title">
                                Risk Title <div class="expandable" style="cursor:pointer;">+</div> 
                            </th>
                            <th class="titleDetail">
                                Description
                            </th>
                            <th class="">
                                Mitigation Strategy
                            </th>
                            <th class="titleDetail">
                                Mitigation Effectiveness
                            </th>
                            <th>
                                Plan Element
                            </th>
                            <th>
                                Status
                            </th>
                            <th class="titleDetail">
                                Source
                            </th>
                            <th class="titleDetail">
                                Event Phase
                            </th>
                            <th class="titleDetail">
                                Likelihood of Occurence
                            </th>
                            <th class="titleDetail">
                                Consequence Consequence of Occurrence
                            </th>
                            <th>
                                Risk Status
                            </th>
                            <th class="titleDetail">
                                Assigned to
                            </th>
                            <th class="budgetDetail">
                                Labor Cost
                            </th>
                            <th class="budgetDetail">
                                ODC Cost
                            </th>
                            <th width="35px" class="budgetDetail ">
                                %
                            </th>
                            <th style="text-align:right;" class="budgetTotal budget">
                                Contingency Cost <div class="expandable" style="cursor:pointer;">+</div> 
                            </th>
                            <th class="titleDetail">
                                Opportunity from Risk
                            </th>
                            <th class="titleDetail">
                                Add Risk to Knowledge Library
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <apex:repeat value="{!risks}" var="risk" id="theRiskRepeater" >
                            <tr class="firstRow">
                                <td class="title">
                                    <apex:outputField value="{!risks[risk].RiskNumber__c}" /><br />
                                </td>
                                <td class="title">
                                    <apex:inputField value="{!risks[risk].Name}" />
                                </td>
                                <td class="titleDetail">
                                    <apex:inputField style="width:350px;height:50px;" value="{!risks[risk].RiskDescription__c}" />
                                </td>
                                <td class="">
                                    <apex:inputField style="width:350px;height:50px;" value="{!risks[risk].RiskMitigation__c}" />
                                </td>
                                <td class="titleDetail">
                                    <apex:inputField value="{!risks[risk].MitigationEffectiveness__c}" />
                                </td>
                                <td>
                                    <apex:inputField value="{!risks[risk].PlanElement__c}" />
                                </td>
                                <td>
                                    <apex:inputField value="{!risks[risk].CurrentStatus__c}" />
                                </td>
                                <td class="titleDetail">
                                    <apex:inputField value="{!risks[risk].Source__c}" />
                                </td>
                                <td class="titleDetail">
                                    <apex:inputField value="{!risks[risk].EventPhase__c}" />
                                </td> 
                                <td class="titleDetail">
                                    <apex:inputField value="{!risks[risk].LikelihoodofOccurrence__c}" />
                                </td>
                                <td class="titleDetail">
                                    <apex:inputField value="{!risks[risk].RiskConsequence__c}" />
                                </td>
                                <td style="text-align:center;">
                                    <apex:outputField value="{!risks[risk].RiskStatus__c}" />
                                </td>
                                <td class="titleDetail">
                                    <apex:inputField value="{!risks[risk].Assignedto__c}" />
                                </td>
                                <td class="budget budgetDetail">
                                    <apex:inputField style="width:100px" value="{!risks[risk].LaborCost__c}" />
                                </td>
                                <td class="budget budgetDetail">
                                    <apex:inputField style="width:100px" value="{!risks[risk].ODCCost__c}" />
                                </td>
                                <td class="budget budgetDetail">
                                    <apex:inputField style="width:20px" value="{!risks[risk].ContingencyPercent__c}" /><span class="percSign">%</span>
                                </td>
                                <td class="budget budgetTotal">
                                    <span style="width:140px">
                                        <apex:inputField value="{!risks[risk].ContingencyDollars__c}" />
                                    </span>
                                </td>
                                <td class="budget titleDetail">
                                    <apex:inputField value="{!risks[risk].OpportunityFromRisk__c}" />
                                </td>
                                <td class="budget titleDetail">
                                    <apex:inputField value="{!risks[risk].AddRiskToKBLib__c}" />
                                </td>
                            </tr>
                        </apex:repeat>
                    </tbody>
                </table>

                <apex:pageBlockSection >
                    <div class="riskLikelihood">
                        <div style="width:100%; height:35px;">
                            <h2>Evaluating Risk</h2>
                        </div>
                        <div class="leftLabel"><h3>Severity</h3></div>

                        <div class="topLabel"><h3>Likelihood</h3></div>
                        <table cellpadding="0" cellspacing="0">
                            <tr>
                                <th></th>
                                <th>5<br/>Moderate</th>
                                <th>10<br/>Major</th>
                                <th>20<br/>Catastrophic</th>
                            </tr>
                            <tbody>
                                <tr>
                                    <td>3<br/>Possible</td>
                                    <td class="greenTd">15</td>
                                    <td class="yellowTd">30</td>
                                    <td class="redTd">60</td>

                                </tr>
                                <tr>
                                    <td>4<br/>Likely</td>
                                    <td class="yellowTd">20</td>
                                    <td class="yellowTd">40</td>
                                    <td class="redTd">80</td>

                                </tr>
                                <tr>
                                    <td>5<br/>Probable</td>
                                    <td class="yellowTd">25</td>
                                    <td class="redTd">50</td>
                                    <td class="redTd">100</td>

                                </tr>

                            </tbody>

                        </table>
                    </div>
                </apex:pageBlockSection>

        </apex:pageBlock>
    </apex:form>


    
</apex:page>
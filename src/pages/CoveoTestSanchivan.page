<apex:page standardstylesheets="false" sidebar="false" docType="html-5.0">
    <CoveoSolutions:CoveoAttachToCase />
    <CoveoSolutions:CoveoJsSearch stylesheet="CoveoFullSearch.css" />
    <script type="text/javascript">
      $(function () {
        Coveo.Rest.SearchEndpoint.configureSampleEndpoint();
        //ScopeSelector: 
		//	is a "select" element allowing to use Coveo Tabs as a dropdown.
		//	Normal tabs are hidden.
		//  Scopeselector items are generated from CoveoTab element data-captions.
		//	"Change" event changes tabs and relaunch the query.
		//  Updates when the #t is sent through

		//ScopeSelector: "Change" event changes tabs and relaunch the query.
          /*Coveo.$('#scopeselector').on('change', function(){
			var ee = $('#scopeselector');
			var selected = ee.val();
			Coveo.$('[data-id='+selected+']').coveo('select');
			Coveo.$('#search').coveo('executeQuery');
		});

		//ScopeSelector: Updates when the #t is sent through
		Coveo.$('#search').on('state:change:t', function(e, args) {
			$('#scopeselector').val(args.value);
		})
		
		//Scopeselector: items are generated from CoveoTab element data-captions.
		Coveo.$("#search").on("afterComponentsInitialization", function(){
			var tabs = Coveo.$('.CoveoTab');
			_.each(Coveo.$('.CoveoTab'), function(tab){
				var newOption = '<option>'+tab.getAttribute('data-caption')+'</option>';
				Coveo.$('#scopeselector').append(newOption);
			});
		})*/
        
        $('#search').coveo('init');
      });
    </script>

    <div id="search" class="CoveoSearchInterface" data-hide-until-first-query="true" data-enable-history="true">
      	<span class="CoveoAnalytics"></span>
		<!--ScopeSelector: element allowing to use Coveo Tabs as a dropdown -->
        <!--select id="scopeselector"></select>
        
        <!--ScopeSelector: Normal tabs are hidden (display:none) -->
        <!--div class="coveo-tab-section" style="display:none">
            <a class="CoveoTab" data-id="All" data-caption="All"  />
            <a class="CoveoTab" data-id="People" data-caption="People" />
            <a class="CoveoTab" data-id="Projects" data-caption="Projects" />
            <a class="CoveoTab" data-id="TPNs"  data-caption="TPNz"/>
        </div-->
      <div class="coveo-tab-section">
        <a 
          class="CoveoTab" 
          data-id='All' 
          data-icon="coveo-sprites-documentType-unknown_x16">All</a>

        <a 
          class="CoveoTab" 
          data-id='Accounts' 
          data-expression='@objecttype=("Account")' 
          data-icon="coveo-sprites-documentType-Salesforce-account_x16">Accounts</a>

        <a 
          class="CoveoTab" 
          data-id='Cases' 
          data-expression='@objecttype=("Case")' 
          data-icon="coveo-sprites-documentType-Salesforce-case_x16">Cases</a>

        <a 
          class="CoveoTab" 
          data-id='Opportunities' 
          data-expression='@objecttype=("Opportunity")' 
          data-icon="coveo-sprites-documentType-Salesforce-opportunity_x16">Opportunities</a>

        <a 
          class="CoveoTab" 
          data-id='People' 
          data-expression='@objecttype=("Contact", "User")' 
          data-icon="coveo-sprites-documentType-person_x16">People</a>
      </div>

      <div class="coveo-search-section">

        <div class="coveo-logo-column">
          <div class="coveo-logo"></div>
        </div>

        <div class="coveo-searchBox-column">
          <div class="coveo-search-section-wrapper">
            <div class="CoveoSettings" data-include-in-menu=".CoveoShareQuery"></div>
            <div class="CoveoSearchBox" data-activate-omnibox="true"></div>
          </div>
        </div>

      </div>

      <div class="coveo-results-section">
        <div class="coveo-facet-column">
          <div 
            class="CoveoFacet" 
            data-title="Type" 
            data-field="@objecttype" 
            data-allow-toggling-operator="true" 
            data-show-icon="true" 
            data-tab="All"></div>

          <div 
            class="CoveoFacet" 
            data-title="Owner" 
            data-field="@sfownername"></div>

          <div 
            class="CoveoFacet" 
            data-title="Account" 
            data-field="@sfaccountname" 
            data-tab="All,Cases,Opportunities"></div>

          <div 
            class="CoveoFacet" 
            data-title="Account Type" 
            data-field="@sfaccounttype" 
            data-tab="Accounts"></div>

          <div 
            class="CoveoFacet" 
            data-title="Status" 
            data-field="@sfcasestatus" 
            data-tab="Cases"></div>

          <div 
            class="CoveoFacet" 
            data-title="Priority" 
            data-field="@sfcasepriority" 
            data-tab="Cases"></div>

          <div 
            class="CoveoFacet" 
            data-title="Contact" 
            data-field="@sfcontactname" 
            data-tab="Cases"></div>

          <div 
            class="CoveoFacet" 
            data-title="Stage" 
            data-field="@Sfopportunitystagename" 
            data-tab="Opportunities"></div>

          <div 
            class="CoveoFacet" 
            data-title="Fore Cast" 
            data-field="@sfopportunitytype" 
            data-tab="Opportunity Type"></div>

          <div 
            class="CoveoFacet" 
            data-title="Fore Cast" 
            data-field="@sfopportunityforecastcategory" 
            data-tab="Opportunities"></div>

          <div 
            class="CoveoFacet" 
            data-title="Lead Source" 
            data-field="@sfleadsource" 
            data-tab="Opportunities"></div>

          <div 
            class="CoveoFacet" 
            data-title="Country" 
            data-field="@sfcountry" 
            data-tab="People"></div>

          <div 
            class="CoveoFacet" 
            data-title="City" 
            data-field="@sfcity" 
            data-tab="People,Accounts"></div>

          <div 
            class="CoveoFacet" 
            data-title="State" 
            data-field="@sfstate" 
            data-tab="People"></div>

          <div 
            class="CoveoFacet" 
            data-title="Industry" 
            data-field="@sfindustry" 
            data-tab="Accounts"></div>

          <div 
            class="CoveoFacet"
            data-title="Department" 
            data-field="@sfuserdepartment" 
            data-tab="People"></div>

          <div 
            class="CoveoFacet" 
            data-title="Division" 
            data-field="@sfuserdivision" 
            data-tab="People"></div>

        </div>

        <div class="coveo-results-column">
          <div class="CoveoShareQuery"></div>
          <div class="CoveoBreadcrumb"></div>

          <div class="coveo-results-header">
            <span class="CoveoQuerySummary"></span>
            <span class="CoveoQueryDuration"></span>
            <span class="coveo-sort-section">
              <span class="CoveoSort" data-sort-criteria="relevancy">Relevance</span>
              <span class="CoveoSort" data-sort-criteria="date descending,date ascending">Date</span>
            </span>
          </div>

          <div class="CoveoHiddenQuery"></div>
          <div class="CoveoDidYouMean"></div>
          <div class="CoveoErrorReport" data-pop-up='true'></div>

          <div class="CoveoResultList" data-wait-animation="fade">

            <script class="result-template" type="text/x-underscore-template">
              <div class="coveo-icon objecttype <%-raw.objecttype%>"><%-raw.objecttype%></div>
              <div class="coveo-date"><%-dateTime(raw.sysdate)%></div>

              <% if (raw.objecttype == "Account") { %>
                <div class="coveo-title">
                  <a class="CoveoResultLink"><%=Title?highlight(Title, titleHighlights):ClickUri%></a>
                </div>
                <table class="CoveoFieldTable">
                  <tr data-field="@sfownername" data-caption="Owner" />
                  <tr data-field="@sfaccounttype" data-caption="Account Type" />
                  <tr data-field="@sfcity" data-caption="City" />
                  <tr data-field="@sfaccountwebsite" data-caption="Website" />
                  <tr data-field="@sfaccountphone" data-caption="Account Phone" />
                  <tr data-field="@sffax" data-caption="Fax" />
                </table>
                <div class="coveo-excerpt">
                  <%=highlight(Excerpt, excerptHighlights)%>
                </div>

              <% } else if (raw.objecttype == "Case") { %>
                <div class="coveo-title">
                  <a class="CoveoResultLink"><%=Title?highlight(Title, titleHighlights):ClickUri%></a>
                </div>
                <table class="CoveoFieldTable">
                  <tr data-field="@sfownername" data-caption="Owner" />
                  <tr data-field="@sfaccountname" data-caption="Account" />
                  <tr data-field="@sfcasestatus" data-caption="Status" />
                  <tr data-field="@sfcasepriority" data-caption="Priority" />
                  <tr data-field="@sfcontactname" data-caption="Contact" />
                </table>

              <% } else if (raw.objecttype == "Opportunity") { %>
                <div class="coveo-title">
                  <a class="CoveoResultLink"><%=Title?highlight(Title, titleHighlights):ClickUri%></a>
                </div>
                <table class="CoveoFieldTable">
                  <tr data-field="@sfaccountname" data-caption="Account" />
                  <tr data-field="@sfownername" data-caption="Owner" />
                  <tr data-field="@sfleadsource" data-caption="Lead Source" />
                  <tr data-field="@SfOpportunityStageName" data-caption="Stage" />
                  <tr data-field="@sfopportunitytype" data-caption="Opportunity Type" />
                  <tr data-field="@sfopportunityforecastcategory" data-caption="Fore Cast Category" />
                </table>
                <div class="coveo-excerpt">
                  <%=highlight(Excerpt, excerptHighlights)%>
                </div>

              <% } else if (raw.objecttype == "Contact") { %>
                <div class="coveo-title">
                  <a class="CoveoResultLink"><%=Title?highlight(Title, titleHighlights):ClickUri%></a>
                </div>
                <table class="CoveoFieldTable">
                  <tr data-field="@objecttype" data-caption="Type" />
                  <tr data-field="@sfcontactname" data-caption="Contact" />
                  <tr data-field="@sfdepartment" data-caption="Department" />
                  <tr data-field="@sfemail" data-caption="Email" data-helper="email" data-html-value="true" />
                  <tr data-field="@sfcontactphone" data-caption="Contact Phone" />
                  <tr data-field="@sffax" data-caption="Fax" />

                  <tr data-field="@sfstreet" data-caption="Address Street" />
                  <tr data-field="@sfstate" data-caption="State" />
                  <tr data-field="@sfcountry" data-caption="Country" />
                  <tr data-field="@sfpostalcode" data-caption="Postal Code" />
                </table>

              <% } else if(raw.objecttype == "User") { %>

                <table class="CoveoFieldTable">
                  <tr>
                    <td><img src="<%= raw.sfsmallphotourl %>" /></td>
                    <td>
                      <div class="coveo-title">
                        <a class="CoveoResultLink"><%=Title?highlight(Title, titleHighlights):ClickUri%></a>
                      </div>
                    </td>
                  </tr>
                  <tr data-field="@objecttype" data-caption="Type" />
                  <tr data-field="@sfuserdepartment" data-caption="Department" />
                  <tr data-field="@sfuserdivision" data-caption="Division" />
                  <tr data-field="@sfusertitle" data-caption="Title" />

                  <tr data-field="@sfemail" data-caption="Email" data-helper="email" data-html-value="true" />
                  <tr data-field="@sfcontactphone" data-caption="Contact Phone" />
                  <tr data-field="@sffax" data-caption="Fax" />

                  <tr data-field="@sfstreet" data-caption="Address Street" />
                  <tr data-field="@sfstate" data-caption="State" />
                  <tr data-field="@sfcountry" data-caption="Country" />
                  <tr data-field="@sfpostalcode" data-caption="Postal Code" />
                </table>

              <% } else if(raw.objecttype == "Event" || raw.objecttype == "Tasks") { %>
                <div class="coveo-title">
                  <a class="CoveoResultLink"><%=Title?highlight(Title, titleHighlights):ClickUri%></a>
                </div>

              <% } else { %>
                <div class="coveo-title">
                  <a class="CoveoResultLink"><%=Title?highlight(Title, titleHighlights):ClickUri%></a>
                </div>
                <div class="coveo-excerpt">
                  <%=highlight(Excerpt, excerptHighlights)%>
                </div>
                <% if (raw.sfkbid) { %>
                  <div class="CoveoAttachToCase"></div>
                <% } %>
              <% } %>
              
            </script>
          </div>
          <div class="CoveoPager"></div>
        </div>
      </div>
    </div>
    <CoveoSolutions:CoveoOpenTabHandler selector=".CoveoResultList" openInSameBrowserTab="true" />
</apex:page>